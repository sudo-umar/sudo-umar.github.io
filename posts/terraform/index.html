<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Terraform | Umar Akram</title><link rel=canonical href=https://sudo-umar.github.io/posts/terraform/><meta name=description content="This mini-library contains some fun stuff and involved topics explained in the easiest way possible. I tried to add some vanilla flavor in the boring topics, so they could be less boring to read ."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Terraform"><meta property="og:description" content="Basics of Terraform main.tf file #define provider and authentication provider &#34;aws&#34; { region = &#34;us-west-2&#34; access_key = &#34;my-access-key&#34; secret_key = &#34;my-secret-keyy&#34; } #How to create resources inside a provider # resource &#34;<provider>_<resource_type>&#34; &#34;name&#34; { # config options ... # key = value # key = value # } #create ec2 instance resource &#34;aws_instance&#34; &#34;first-ec2instance&#34; { ami = &#34;ami-0d75513e7706cf2d9&#34; instance_type = &#34;t2.micro&#34; } terraform running terminal command Now run > terraform init (from terminal) terraform plan (optional to get what you are going to do with this tf config file)"><meta property="og:type" content="article"><meta property="og:url" content="https://sudo-umar.github.io/posts/terraform/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-27T09:55:31+02:00"><meta property="article:modified_time" content="2022-07-27T09:55:31+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Terraform"><meta name=twitter:description content="Basics of Terraform main.tf file #define provider and authentication provider &#34;aws&#34; { region = &#34;us-west-2&#34; access_key = &#34;my-access-key&#34; secret_key = &#34;my-secret-keyy&#34; } #How to create resources inside a provider # resource &#34;<provider>_<resource_type>&#34; &#34;name&#34; { # config options ... # key = value # key = value # } #create ec2 instance resource &#34;aws_instance&#34; &#34;first-ec2instance&#34; { ami = &#34;ami-0d75513e7706cf2d9&#34; instance_type = &#34;t2.micro&#34; } terraform running terminal command Now run > terraform init (from terminal) terraform plan (optional to get what you are going to do with this tf config file)"><link rel=stylesheet href=https://sudo-umar.github.io/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://sudo-umar.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://sudo-umar.github.io/posts/mlflow/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&text=Terraform" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&title=Terraform" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&is_video=false&description=Terraform" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Terraform&body=Check out this article: https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&title=Terraform" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&title=Terraform" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&name=Terraform&description=Basics%20of%20Terraform%20main.tf%20file%20%23define%20provider%20and%20authentication%20provider%20%26%2334%3baws%26%2334%3b%20%7b%20region%20%3d%20%26%2334%3bus-west-2%26%2334%3b%20access_key%20%3d%20%26%2334%3bmy-access-key%26%2334%3b%20secret_key%20%3d%20%26%2334%3bmy-secret-keyy%26%2334%3b%20%7d%20%23How%20to%20create%20resources%20inside%20a%20provider%20%23%20resource%20%26%2334%3b%26lt%3bprovider%26gt%3b_%26lt%3bresource_type%26gt%3b%26%2334%3b%20%26%2334%3bname%26%2334%3b%20%7b%20%23%20config%20options%20...%20%23%20key%20%3d%20value%20%23%20key%20%3d%20value%20%23%20%7d%20%23create%20ec2%20instance%20resource%20%26%2334%3baws_instance%26%2334%3b%20%26%2334%3bfirst-ec2instance%26%2334%3b%20%7b%20ami%20%3d%20%26%2334%3bami-0d75513e7706cf2d9%26%2334%3b%20instance_type%20%3d%20%26%2334%3bt2.micro%26%2334%3b%20%7d%20terraform%20running%20terminal%20command%20Now%20run%20%26gt%3b%20terraform%20init%20%28from%20terminal%29%20terraform%20plan%20%28optional%20to%20get%20what%20you%20are%20going%20to%20do%20with%20this%20tf%20config%20file%29" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&t=Terraform" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#maintf-file>main.tf file</a></li><li><a href=#terraform-running-terminal-command>terraform running terminal command</a></li><li><a href=#terraform-folder>.terraform folder</a></li><li><a href=#terraformtfstate>terraform.tfstate</a></li><li><a href=#terraform-variables>terraform variables</a></li><li><a href=#further-commands>Further commands</a></li><li><a href=#complete-project>Complete project</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Terraform</h1><div class=meta><div class=postdate><time datetime="2022-07-27 09:55:31 +0200 +0200" itemprop=datePublished>2022-07-27</time></div></div></header><div class=content itemprop=articleBody><h1 id=basics-of-terraform>Basics of Terraform</h1><h3 id=maintf-file>main.tf file</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#75715e>#define provider and authentication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>provider</span> <span style=color:#e6db74>&#34;aws&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>region</span>     = <span style=color:#e6db74>&#34;us-west-2&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>access_key</span> = <span style=color:#e6db74>&#34;my-access-key&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secret_key</span> = <span style=color:#e6db74>&#34;my-secret-keyy&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#How to create resources inside a provider
</span></span></span><span style=display:flex><span><span style=color:#75715e># resource &#34;&lt;provider&gt;_&lt;resource_type&gt;&#34; &#34;name&#34; {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     config options ...
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     key = value
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     key = value
</span></span></span><span style=display:flex><span><span style=color:#75715e>  
</span></span></span><span style=display:flex><span><span style=color:#75715e># }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#create  ec2 instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34;</span> <span style=color:#e6db74>&#34;first-ec2instance&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ami</span> = <span style=color:#e6db74>&#34;ami-0d75513e7706cf2d9&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>instance_type</span> = <span style=color:#e6db74>&#34;t2.micro&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=terraform-running-terminal-command>terraform running terminal command</h3><ol><li>Now run > terraform init (from terminal)</li><li><blockquote><p>terraform plan (optional to get what you are going to do with this tf config file)</p></blockquote></li><li><blockquote><p>terraform apply (terraform apply &ndash;auto-approve if you dont want to type yes)</p></blockquote></li></ol><hr><ol start=4><li><blockquote><p>terraform destroy (will destroy the created resources. For single destroy you
need to add parameters in the above command)
Or an alternative could be to remove that resource code and run terraform apply(declarative approach)</p></blockquote></li></ol><p><strong>Your ami value is different for different regions, so fetch ami value after selecting the region you mentioned in the provider dictionary.</strong></p><h3 id=terraform-folder>.terraform folder</h3><p>is created by the terraform init command to install the required packages for the mentioned provider in the tf file.</p><h3 id=terraformtfstate>terraform.tfstate</h3><p>This file is critical for the proper fucntioning as it keeps track of the current state of all the variable associated with our resources.</p><h3 id=terraform-variables>terraform variables</h3><h5 id=definition-of-a-varible-inside-tf-file>Definition of a varible inside .tf file</h5><p>variable &ldquo;nameofvariable&rdquo;{
description = &ldquo;repres cidr block&rdquo; (Optional)
default = "" (Optional)
type = string(optional)
}</p><h5 id=variable-as-list>Variable as list</h5><p><strong>Assigning value to a varin .tfvars file:</strong>
subnet = [&lsquo;10.0.0.1/24&rsquo;,&lsquo;10.0.1.0/24&rsquo;]
<strong>Access this variable in .tf file:</strong>
cidr_block = subnet[0]</p><h5 id=variable-as-an-object>Variable as an object</h5><p><strong>Assign value to a variable in .tfvars file</strong>
subnet = [
{
cidr_bloc=&lsquo;10.0.0.0/24&rsquo;,
name = &ldquo;production&rdquo;
},
{
cidr_block = value
name = value
}]
<strong>Access these values</strong>
cidr_block = var.subnet[0].cidr_block
name = var.subnet[1].name</p><h5 id=passing-value-to-a-varialbe>Passing value to a varialbe</h5><p>3 ways:</p><ol><li>When we apply(terraform apply), the terraform will ask us to enter the value through command line.</li><li><blockquote><p>terraform apply -var &ldquo;varname = value&rdquo;</p></blockquote></li><li>Best way is to create a separate file for variable assignment. Create a file called &ldquo;terraform.tfvars&rdquo;. Inside this file give value to all the variable.
nameofvariable = value</li><li>Through default = value in the definition of the variable.</li></ol><h5 id=how-to-reference-variable>How to reference variable</h5><p>cidr_block = var.nameofvariable</p><h3 id=further-commands>Further commands</h3><ol><li><blockquote><p>terraform state list</p></blockquote></li><li><blockquote><p>terraform state show resourcename</p></blockquote></li><li>Resource name in the above command will come from the first command. It will display the ocmplete information regarding that resource</li><li>__> output &ldquo;this is the print statement&rdquo;{ value = resource.resourcename.property}</li><li>Insted of seeing the desired variable values through the second command. We can simply print them out through the 4th command.</li><li><blockquote><p>terraform output</p></blockquote></li><li><blockquote><p>terraform refresh (to get all the states without applying them)</p></blockquote></li><li><blockquote><p>terraform apply target resource.resourcename (for staged deployement only this resource will be deployed)</p></blockquote></li></ol><h3 id=complete-project>Complete project</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#75715e># define provider
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>provider</span> <span style=color:#e6db74>&#34;aws&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>region</span> = <span style=color:#e6db74>&#34;us-east-1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>access_key</span> = <span style=color:#e6db74>&#34;Your key from security credentials&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secret_key</span> = <span style=color:#e6db74>&#34;Your key from aws security credentials&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#How to create resources inside a provider
</span></span></span><span style=display:flex><span><span style=color:#75715e># resource &#34;&lt;provider&gt;_&lt;resource_type&gt;&#34; &#34;name&#34; {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     config options ...
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     key = value
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     key = value
</span></span></span><span style=display:flex><span><span style=color:#75715e>  
</span></span></span><span style=display:flex><span><span style=color:#75715e># }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># define ec2 instance
</span></span></span><span style=display:flex><span><span style=color:#75715e># Go to terraform documentation of aws then go to
</span></span></span><span style=display:flex><span><span style=color:#75715e># ec2 -&gt; resources-&gt;aws_instance
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># resource &#34;aws_instance&#34; &#34;terraformec2&#34; {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   ami           = &#34;ami-052efd3df9dad4825&#34;   #different regions have different ami values. ec2 inst ami value
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   instance_type = &#34;t2.micro&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   tags = {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     &#34;Name&#34; = &#34;ubuntu&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   }
</span></span></span><span style=display:flex><span><span style=color:#75715e># }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#  if you comment out the above resource code, it will destroy the created instance &#39;terraformec2&#39; 
</span></span></span><span style=display:flex><span><span style=color:#75715e>#  on running terraform apply command
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># define VPC in aws
</span></span></span><span style=display:flex><span><span style=color:#75715e># resource &#34;aws_vpc&#34; &#34;vpc-1&#34; {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   cidr_block = &#34;10.0.0.0/16&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   tags = {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     &#34;Name&#34; = &#34;production&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   }
</span></span></span><span style=display:flex><span><span style=color:#75715e># }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># define subnet
</span></span></span><span style=display:flex><span><span style=color:#75715e># resource &#34;aws_subnet&#34; &#34;subnet-1&#34; {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   vpc_id = aws_vpc.vpc-1.id       #reference other resource..resource.resourcename.property
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   cidr_block = &#34;10.0.1.0/24&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   tags = {
</span></span></span><span style=display:flex><span><span style=color:#75715e>#     &#34;Name&#34; = &#34;prod-subnet&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e>#   } 
</span></span></span><span style=display:flex><span><span style=color:#75715e># }
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#Complete tutorial
</span></span></span><span style=display:flex><span><span style=color:#75715e># create keypair of ec2 instance
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#1. Create vpc network
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_vpc&#34;</span> <span style=color:#e6db74>&#34;vpc-prod&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cidr_block</span> = <span style=color:#e6db74>&#34;10.0.0.0/16&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;production&#34;</span>
</span></span><span style=display:flex><span>  }  
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 2. create internet gateway
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_internet_gateway&#34;</span> <span style=color:#e6db74>&#34;gw&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>vpc</span><span style=color:#f92672>-</span><span style=color:#a6e22e>prod</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;production&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 3. Create route table
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table&#34;</span> <span style=color:#e6db74>&#34;prod-rtable&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>vpc</span><span style=color:#f92672>-</span><span style=color:#a6e22e>prod</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_block</span> = <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span><span style=color:#75715e>  #send all traffic to gatewway id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>gateway_id</span> = <span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>gw</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ipv6_cidr_block</span>        = <span style=color:#e6db74>&#34;::/0&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gateway_id</span> = <span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>gw</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;production&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 4. Create subnet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_subnet&#34;</span> <span style=color:#e6db74>&#34;prod-subnet&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>vpc</span><span style=color:#f92672>-</span><span style=color:#a6e22e>prod</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cidr_block</span> = <span style=color:#e6db74>&#34;10.0.1.0/24&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>availability_zone</span> = <span style=color:#e6db74>&#34;us-east-1a&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Name&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;production-subnet&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 5. Associate subnet with route table
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table_association&#34;</span> <span style=color:#e6db74>&#34;prod-rt-association&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span> = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>prod</span><span style=color:#f92672>-</span><span style=color:#a6e22e>subnet</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route_table_id</span> = <span style=color:#a6e22e>aws_route_table</span>.<span style=color:#a6e22e>prod</span><span style=color:#f92672>-</span><span style=color:#a6e22e>rtable</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 6. create security group
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;allow_webtraffic&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;allow_web_traffic&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allow Web traffic traffic&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>vpc</span><span style=color:#f92672>-</span><span style=color:#a6e22e>prod</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span>      = <span style=color:#e6db74>&#34;HTTPS&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>        = <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>          = <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>         = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span>      = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]<span style=color:#75715e> #any ip address we can also give a specific ip address
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span>      = <span style=color:#e6db74>&#34;HTTP&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>        = <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>          = <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>         = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span>      = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]<span style=color:#75715e> #any ip address we can also give a specific ip address
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span>      = <span style=color:#e6db74>&#34;SSH&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>        = <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>          = <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>         = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span>      = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]<span style=color:#75715e> #any ip address we can also give a specific ip address
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>egress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>        = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>          = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>         = <span style=color:#e6db74>&#34;-1&#34;</span><span style=color:#75715e> #any protocl
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>cidr_blocks</span>      = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ipv6_cidr_blocks</span> = [<span style=color:#e6db74>&#34;::/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;allow_web&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 7. network interface
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_network_interface&#34;</span> <span style=color:#e6db74>&#34;prod-network-interface&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>       = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>prod</span><span style=color:#f92672>-</span><span style=color:#a6e22e>subnet</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>private_ips</span>     = [<span style=color:#e6db74>&#34;10.0.1.50&#34;</span>]<span style=color:#75715e> # choose ip for server, we can give a list of ips
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>security_groups</span> = [<span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>allow_webtraffic</span>.<span style=color:#a6e22e>id</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 8. eip for public access
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_eip&#34;</span> <span style=color:#e6db74>&#34;prod-eip-one&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc</span>                       = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>network_interface</span>         = <span style=color:#a6e22e>aws_network_interface</span>.<span style=color:#a6e22e>prod</span><span style=color:#f92672>-</span><span style=color:#a6e22e>network</span><span style=color:#f92672>-</span><span style=color:#a6e22e>interface</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>associate_with_private_ip</span> = <span style=color:#e6db74>&#34;10.0.1.50&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depends_on</span> = [<span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>gw</span>]
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># 9. create ubuntu server and install apache
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34;</span> <span style=color:#e6db74>&#34;web-ubuntu-server&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ami</span> = <span style=color:#e6db74>&#34;ami-052efd3df9dad4825&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>instance_type</span> = <span style=color:#e6db74>&#34;t2.micro&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>availability_zone</span> = <span style=color:#e6db74>&#34;us-east-1a&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>key_name</span> = <span style=color:#e6db74>&#34;main-key&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>network_interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>device_index</span> = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>network_interface_id</span> = <span style=color:#a6e22e>aws_network_interface</span>.<span style=color:#a6e22e>prod</span><span style=color:#f92672>-</span><span style=color:#a6e22e>network</span><span style=color:#f92672>-</span><span style=color:#a6e22e>interface</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>user_data</span> = <span style=color:#f92672>&lt;&lt;-EOF</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              #!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              sudo apt update -y
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              sudo apt install apache2 -y
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              sudo systemctl start apache2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              sudo bash -c &#39;echo your first web server &gt;/var/www/html/index.html&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              </span><span style=color:#f92672>EOF</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Name&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;webserver&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><ul><li><a href=#maintf-file>main.tf file</a></li><li><a href=#terraform-running-terminal-command>terraform running terminal command</a></li><li><a href=#terraform-folder>.terraform folder</a></li><li><a href=#terraformtfstate>terraform.tfstate</a></li><li><a href=#terraform-variables>terraform variables</a></li><li><a href=#further-commands>Further commands</a></li><li><a href=#complete-project>Complete project</a></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&text=Terraform" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&title=Terraform" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&is_video=false&description=Terraform" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Terraform&body=Check out this article: https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&title=Terraform" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&title=Terraform" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&name=Terraform&description=Basics%20of%20Terraform%20main.tf%20file%20%23define%20provider%20and%20authentication%20provider%20%26%2334%3baws%26%2334%3b%20%7b%20region%20%3d%20%26%2334%3bus-west-2%26%2334%3b%20access_key%20%3d%20%26%2334%3bmy-access-key%26%2334%3b%20secret_key%20%3d%20%26%2334%3bmy-secret-keyy%26%2334%3b%20%7d%20%23How%20to%20create%20resources%20inside%20a%20provider%20%23%20resource%20%26%2334%3b%26lt%3bprovider%26gt%3b_%26lt%3bresource_type%26gt%3b%26%2334%3b%20%26%2334%3bname%26%2334%3b%20%7b%20%23%20config%20options%20...%20%23%20key%20%3d%20value%20%23%20key%20%3d%20value%20%23%20%7d%20%23create%20ec2%20instance%20resource%20%26%2334%3baws_instance%26%2334%3b%20%26%2334%3bfirst-ec2instance%26%2334%3b%20%7b%20ami%20%3d%20%26%2334%3bami-0d75513e7706cf2d9%26%2334%3b%20instance_type%20%3d%20%26%2334%3bt2.micro%26%2334%3b%20%7d%20terraform%20running%20terminal%20command%20Now%20run%20%26gt%3b%20terraform%20init%20%28from%20terminal%29%20terraform%20plan%20%28optional%20to%20get%20what%20you%20are%20going%20to%20do%20with%20this%20tf%20config%20file%29" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsudo-umar.github.io%2fposts%2fterraform%2f&t=Terraform" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 Umar Akram</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script></html>